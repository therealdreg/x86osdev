# Copyright (C) 2017  The Bochs Project
#
# This library is free software; you can redistribute it and/or
# modify it under the terms of the GNU Lesser General Public
# License as published by the Free Software Foundation; either
# version 2 of the License, or (at your option) any later version.
#
# This library is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
# Lesser General Public License for more details.
#
# You should have received a copy of the GNU Lesser General Public
# License along with this library; if not, write to the Free Software
# Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA  02110-1301 USA

# Makefile for the cpu/avx component of bochs

@SUFFIX_LINE@

srcdir = @srcdir@
VPATH = @srcdir@
top_builddir    = ../..
top_srcdir      = @top_srcdir@

SHELL = @SHELL@

@SET_MAKE@

CC       = @CC@
CFLAGS   = @CFLAGS@ @GUI_CFLAGS@
CXX      = @CXX@
CXXFLAGS = @CXXFLAGS@ @GUI_CXXFLAGS@

#CFLAGS  = -Wall -Wstrict-prototypes -fomit-frame-pointer -fno-strict-aliasing -pipe -fno-strength-reduce -mpreferred-stack-boundary=2 -DCPU=686 -march=i686

LDFLAGS    = @LDFLAGS@
LIBS       = @LIBS@
RANLIB     = @RANLIB@

BX_INCDIRS = -I.. -I../.. -I$(srcdir)/.. -I$(srcdir)/../.. -I../../@INSTRUMENT_DIR@ -I$(srcdir)/../../@INSTRUMENT_DIR@

# Objects which are only used for AVX / EVEX code
AVX_OBJS = \
	avx.o \
	avx_pfp.o \
	avx_cvt.o \
	avx_fma.o \
	avx2.o \
	avx512.o \
	avx512_broadcast.o \
	avx512_move.o \
	avx512_pfp.o \
	avx512_rcp14.o \
	avx512_rsqrt14.o \
	avx512_cvt.o \
	avx512_fma.o \
	avx512_mask8.o \
	avx512_mask16.o \
	avx512_mask32.o \
	avx512_mask64.o \
	avx512_bitalg.o \
	vnni.o \
	gather.o \
	tbm32.o \
	tbm64.o \
	xop.o

all: libavx.a

.@CPP_SUFFIX@.o:
	$(CXX) @DASH@c $(BX_INCDIRS) $(CXXFLAGS) @CXXFP@$< @OFP@$@

.c.o:
	$(CC) @DASH@c $(CFLAGS) $(BX_INCDIRS) $< @OFP@$@


libavx.a: $(AVX_OBJS)
	@RMCOMMAND@ libavx.a
	@MAKELIB@ $(AVX_OBJS)
	$(RANLIB) libavx.a

clean:
	@RMCOMMAND@ *.o
	@RMCOMMAND@ *.a

dist-clean: clean
	@RMCOMMAND@ Makefile

###########################################
# dependencies generated by
#  gcc -MM -I.. -I../.. -I../../instrument/stubs *.cc | sed 's/\.cc/.@CPP_SUFFIX@/g'
###########################################
avx.o: avx.@CPP_SUFFIX@ ../../bochs.h ../../config.h ../../osdep.h \
 ../../bx_debug/debug.h ../../config.h ../../osdep.h \
 ../../cpu/decoder/decoder.h ../../gui/paramtree.h ../../logio.h \
 ../../instrument/stubs/instrument.h ../cpu.h \
 ../decoder/decoder.h ../i387.h ../fpu/softfloat.h ../fpu/tag_w.h \
 ../fpu/status_w.h ../fpu/control_w.h ../crregs.h ../descriptor.h \
 ../decoder/instr.h ../lazy_flags.h ../tlb.h ../icache.h ../apic.h \
 ../xmm.h ../vmx.h ../svm.h ../cpuid.h ../stack.h ../access.h \
 ../simd_int.h
avx2.o: avx2.@CPP_SUFFIX@ ../../bochs.h ../../config.h ../../osdep.h \
 ../../bx_debug/debug.h ../../config.h ../../osdep.h \
 ../../cpu/decoder/decoder.h ../../gui/paramtree.h ../../logio.h \
 ../../instrument/stubs/instrument.h ../cpu.h \
 ../decoder/decoder.h ../i387.h ../fpu/softfloat.h ../fpu/tag_w.h \
 ../fpu/status_w.h ../fpu/control_w.h ../crregs.h ../descriptor.h \
 ../decoder/instr.h ../lazy_flags.h ../tlb.h ../icache.h ../apic.h \
 ../xmm.h ../vmx.h ../svm.h ../cpuid.h ../stack.h ../access.h \
 ../simd_int.h ../simd_compare.h
avx512.o: avx512.@CPP_SUFFIX@ ../../bochs.h ../../config.h ../../osdep.h \
 ../../bx_debug/debug.h ../../config.h ../../osdep.h \
 ../../cpu/decoder/decoder.h ../../gui/paramtree.h ../../logio.h \
 ../../instrument/stubs/instrument.h ../cpu.h \
 ../decoder/decoder.h ../i387.h ../fpu/softfloat.h ../fpu/tag_w.h \
 ../fpu/status_w.h ../fpu/control_w.h ../crregs.h ../descriptor.h \
 ../decoder/instr.h ../lazy_flags.h ../tlb.h ../icache.h ../apic.h \
 ../xmm.h ../vmx.h ../svm.h ../cpuid.h ../stack.h ../access.h \
 ../simd_int.h ../simd_compare.h ../wide_int.h
avx512_bitalg.o: avx512_bitalg.@CPP_SUFFIX@ ../../bochs.h ../../config.h \
 ../../osdep.h ../../bx_debug/debug.h ../../config.h ../../osdep.h \
 ../../cpu/decoder/decoder.h ../../gui/paramtree.h ../../logio.h \
 ../../instrument/stubs/instrument.h ../cpu.h \
 ../decoder/decoder.h ../i387.h ../fpu/softfloat.h ../fpu/tag_w.h \
 ../fpu/status_w.h ../fpu/control_w.h ../crregs.h ../descriptor.h \
 ../decoder/instr.h ../lazy_flags.h ../tlb.h ../icache.h ../apic.h \
 ../xmm.h ../vmx.h ../svm.h ../cpuid.h ../stack.h ../access.h \
 ../simd_int.h ../scalar_arith.h
avx512_broadcast.o: avx512_broadcast.@CPP_SUFFIX@ ../../bochs.h ../../config.h \
 ../../osdep.h ../../bx_debug/debug.h ../../config.h ../../osdep.h \
 ../../cpu/decoder/decoder.h ../../gui/paramtree.h ../../logio.h \
 ../../instrument/stubs/instrument.h ../cpu.h \
 ../decoder/decoder.h ../i387.h ../fpu/softfloat.h ../fpu/tag_w.h \
 ../fpu/status_w.h ../fpu/control_w.h ../crregs.h ../descriptor.h \
 ../decoder/instr.h ../lazy_flags.h ../tlb.h ../icache.h ../apic.h \
 ../xmm.h ../vmx.h ../svm.h ../cpuid.h ../stack.h ../access.h \
 ../simd_int.h
avx512_cvt.o: avx512_cvt.@CPP_SUFFIX@ ../../bochs.h ../../config.h ../../osdep.h \
 ../../bx_debug/debug.h ../../config.h ../../osdep.h \
 ../../cpu/decoder/decoder.h ../../gui/paramtree.h ../../logio.h \
 ../../instrument/stubs/instrument.h ../cpu.h \
 ../decoder/decoder.h ../i387.h ../fpu/softfloat.h ../fpu/tag_w.h \
 ../fpu/status_w.h ../fpu/control_w.h ../crregs.h ../descriptor.h \
 ../decoder/instr.h ../lazy_flags.h ../tlb.h ../icache.h ../apic.h \
 ../xmm.h ../vmx.h ../svm.h ../cpuid.h ../stack.h ../access.h \
 ../simd_int.h
avx512_fma.o: avx512_fma.@CPP_SUFFIX@ ../../bochs.h ../../config.h ../../osdep.h \
 ../../bx_debug/debug.h ../../config.h ../../osdep.h \
 ../../cpu/decoder/decoder.h ../../gui/paramtree.h ../../logio.h \
 ../../instrument/stubs/instrument.h ../cpu.h \
 ../decoder/decoder.h ../i387.h ../fpu/softfloat.h ../fpu/tag_w.h \
 ../fpu/status_w.h ../fpu/control_w.h ../crregs.h ../descriptor.h \
 ../decoder/instr.h ../lazy_flags.h ../tlb.h ../icache.h ../apic.h \
 ../xmm.h ../vmx.h ../svm.h ../cpuid.h ../stack.h ../access.h \
 ../simd_int.h ../simd_pfp.h
avx512_mask16.o: avx512_mask16.@CPP_SUFFIX@ ../../bochs.h ../../config.h \
 ../../osdep.h ../../bx_debug/debug.h ../../config.h ../../osdep.h \
 ../../cpu/decoder/decoder.h ../../gui/paramtree.h ../../logio.h \
 ../../instrument/stubs/instrument.h ../cpu.h \
 ../decoder/decoder.h ../i387.h ../fpu/softfloat.h ../fpu/tag_w.h \
 ../fpu/status_w.h ../fpu/control_w.h ../crregs.h ../descriptor.h \
 ../decoder/instr.h ../lazy_flags.h ../tlb.h ../icache.h ../apic.h \
 ../xmm.h ../vmx.h ../svm.h ../cpuid.h ../stack.h ../access.h
avx512_mask32.o: avx512_mask32.@CPP_SUFFIX@ ../../bochs.h ../../config.h \
 ../../osdep.h ../../bx_debug/debug.h ../../config.h ../../osdep.h \
 ../../cpu/decoder/decoder.h ../../gui/paramtree.h ../../logio.h \
 ../../instrument/stubs/instrument.h ../cpu.h \
 ../decoder/decoder.h ../i387.h ../fpu/softfloat.h ../fpu/tag_w.h \
 ../fpu/status_w.h ../fpu/control_w.h ../crregs.h ../descriptor.h \
 ../decoder/instr.h ../lazy_flags.h ../tlb.h ../icache.h ../apic.h \
 ../xmm.h ../vmx.h ../svm.h ../cpuid.h ../stack.h ../access.h
avx512_mask64.o: avx512_mask64.@CPP_SUFFIX@ ../../bochs.h ../../config.h \
 ../../osdep.h ../../bx_debug/debug.h ../../config.h ../../osdep.h \
 ../../cpu/decoder/decoder.h ../../gui/paramtree.h ../../logio.h \
 ../../instrument/stubs/instrument.h ../cpu.h \
 ../decoder/decoder.h ../i387.h ../fpu/softfloat.h ../fpu/tag_w.h \
 ../fpu/status_w.h ../fpu/control_w.h ../crregs.h ../descriptor.h \
 ../decoder/instr.h ../lazy_flags.h ../tlb.h ../icache.h ../apic.h \
 ../xmm.h ../vmx.h ../svm.h ../cpuid.h ../stack.h ../access.h
avx512_mask8.o: avx512_mask8.@CPP_SUFFIX@ ../../bochs.h ../../config.h \
 ../../osdep.h ../../bx_debug/debug.h ../../config.h ../../osdep.h \
 ../../cpu/decoder/decoder.h ../../gui/paramtree.h ../../logio.h \
 ../../instrument/stubs/instrument.h ../cpu.h \
 ../decoder/decoder.h ../i387.h ../fpu/softfloat.h ../fpu/tag_w.h \
 ../fpu/status_w.h ../fpu/control_w.h ../crregs.h ../descriptor.h \
 ../decoder/instr.h ../lazy_flags.h ../tlb.h ../icache.h ../apic.h \
 ../xmm.h ../vmx.h ../svm.h ../cpuid.h ../stack.h ../access.h
avx512_move.o: avx512_move.@CPP_SUFFIX@ ../../bochs.h ../../config.h ../../osdep.h \
 ../../bx_debug/debug.h ../../config.h ../../osdep.h \
 ../../cpu/decoder/decoder.h ../../gui/paramtree.h ../../logio.h \
 ../../instrument/stubs/instrument.h ../cpu.h \
 ../decoder/decoder.h ../i387.h ../fpu/softfloat.h ../fpu/tag_w.h \
 ../fpu/status_w.h ../fpu/control_w.h ../crregs.h ../descriptor.h \
 ../decoder/instr.h ../lazy_flags.h ../tlb.h ../icache.h ../apic.h \
 ../xmm.h ../vmx.h ../svm.h ../cpuid.h ../stack.h ../access.h \
 ../simd_int.h
avx512_pfp.o: avx512_pfp.@CPP_SUFFIX@ ../../bochs.h ../../config.h ../../osdep.h \
 ../../bx_debug/debug.h ../../config.h ../../osdep.h \
 ../../cpu/decoder/decoder.h ../../gui/paramtree.h ../../logio.h \
 ../../instrument/stubs/instrument.h ../cpu.h \
 ../decoder/decoder.h ../i387.h ../fpu/softfloat.h ../fpu/tag_w.h \
 ../fpu/status_w.h ../fpu/control_w.h ../crregs.h ../descriptor.h \
 ../decoder/instr.h ../lazy_flags.h ../tlb.h ../icache.h ../apic.h \
 ../xmm.h ../vmx.h ../svm.h ../cpuid.h ../stack.h ../access.h \
 ../fpu/softfloat-compare.h ../fpu/softfloat.h ../simd_int.h \
 ../simd_pfp.h ../fpu/softfloat-specialize.h
avx512_rcp14.o: avx512_rcp14.@CPP_SUFFIX@ ../../bochs.h ../../config.h \
 ../../osdep.h ../../bx_debug/debug.h ../../config.h ../../osdep.h \
 ../../cpu/decoder/decoder.h ../../gui/paramtree.h ../../logio.h \
 ../../instrument/stubs/instrument.h ../cpu.h \
 ../decoder/decoder.h ../i387.h ../fpu/softfloat.h ../fpu/tag_w.h \
 ../fpu/status_w.h ../fpu/control_w.h ../crregs.h ../descriptor.h \
 ../decoder/instr.h ../lazy_flags.h ../tlb.h ../icache.h ../apic.h \
 ../xmm.h ../vmx.h ../svm.h ../cpuid.h ../stack.h ../access.h \
 ../fpu/softfloat-specialize.h ../fpu/softfloat.h \
 ../fpu/softfloat-round-pack.h ../simd_int.h
avx512_rsqrt14.o: avx512_rsqrt14.@CPP_SUFFIX@ ../../bochs.h ../../config.h \
 ../../osdep.h ../../bx_debug/debug.h ../../config.h ../../osdep.h \
 ../../cpu/decoder/decoder.h ../../gui/paramtree.h ../../logio.h \
 ../../instrument/stubs/instrument.h ../cpu.h \
 ../decoder/decoder.h ../i387.h ../fpu/softfloat.h ../fpu/tag_w.h \
 ../fpu/status_w.h ../fpu/control_w.h ../crregs.h ../descriptor.h \
 ../decoder/instr.h ../lazy_flags.h ../tlb.h ../icache.h ../apic.h \
 ../xmm.h ../vmx.h ../svm.h ../cpuid.h ../stack.h ../access.h \
 ../fpu/softfloat-specialize.h ../fpu/softfloat.h \
 ../fpu/softfloat-round-pack.h ../simd_int.h
avx_cvt.o: avx_cvt.@CPP_SUFFIX@ ../../bochs.h ../../config.h ../../osdep.h \
 ../../bx_debug/debug.h ../../config.h ../../osdep.h \
 ../../cpu/decoder/decoder.h ../../gui/paramtree.h ../../logio.h \
 ../../instrument/stubs/instrument.h ../cpu.h \
 ../decoder/decoder.h ../i387.h ../fpu/softfloat.h ../fpu/tag_w.h \
 ../fpu/status_w.h ../fpu/control_w.h ../crregs.h ../descriptor.h \
 ../decoder/instr.h ../lazy_flags.h ../tlb.h ../icache.h ../apic.h \
 ../xmm.h ../vmx.h ../svm.h ../cpuid.h ../stack.h ../access.h
avx_fma.o: avx_fma.@CPP_SUFFIX@ ../../bochs.h ../../config.h ../../osdep.h \
 ../../bx_debug/debug.h ../../config.h ../../osdep.h \
 ../../cpu/decoder/decoder.h ../../gui/paramtree.h ../../logio.h \
 ../../instrument/stubs/instrument.h ../cpu.h \
 ../decoder/decoder.h ../i387.h ../fpu/softfloat.h ../fpu/tag_w.h \
 ../fpu/status_w.h ../fpu/control_w.h ../crregs.h ../descriptor.h \
 ../decoder/instr.h ../lazy_flags.h ../tlb.h ../icache.h ../apic.h \
 ../xmm.h ../vmx.h ../svm.h ../cpuid.h ../stack.h ../access.h \
 ../simd_pfp.h
avx_pfp.o: avx_pfp.@CPP_SUFFIX@ ../../bochs.h ../../config.h ../../osdep.h \
 ../../bx_debug/debug.h ../../config.h ../../osdep.h \
 ../../cpu/decoder/decoder.h ../../gui/paramtree.h ../../logio.h \
 ../../instrument/stubs/instrument.h ../cpu.h \
 ../decoder/decoder.h ../i387.h ../fpu/softfloat.h ../fpu/tag_w.h \
 ../fpu/status_w.h ../fpu/control_w.h ../crregs.h ../descriptor.h \
 ../decoder/instr.h ../lazy_flags.h ../tlb.h ../icache.h ../apic.h \
 ../xmm.h ../vmx.h ../svm.h ../cpuid.h ../stack.h ../access.h \
 ../fpu/softfloat-compare.h ../fpu/softfloat.h ../simd_pfp.h \
 ../simd_int.h
gather.o: gather.@CPP_SUFFIX@ ../../bochs.h ../../config.h ../../osdep.h \
 ../../bx_debug/debug.h ../../config.h ../../osdep.h \
 ../../cpu/decoder/decoder.h ../../gui/paramtree.h ../../logio.h \
 ../../instrument/stubs/instrument.h ../cpu.h \
 ../decoder/decoder.h ../i387.h ../fpu/softfloat.h ../fpu/tag_w.h \
 ../fpu/status_w.h ../fpu/control_w.h ../crregs.h ../descriptor.h \
 ../decoder/instr.h ../lazy_flags.h ../tlb.h ../icache.h ../apic.h \
 ../xmm.h ../vmx.h ../svm.h ../cpuid.h ../stack.h ../access.h
tbm32.o: tbm32.@CPP_SUFFIX@ ../../bochs.h ../../config.h ../../osdep.h \
 ../../bx_debug/debug.h ../../config.h ../../osdep.h \
 ../../cpu/decoder/decoder.h ../../gui/paramtree.h ../../logio.h \
 ../../instrument/stubs/instrument.h ../cpu.h \
 ../decoder/decoder.h ../i387.h ../fpu/softfloat.h ../fpu/tag_w.h \
 ../fpu/status_w.h ../fpu/control_w.h ../crregs.h ../descriptor.h \
 ../decoder/instr.h ../lazy_flags.h ../tlb.h ../icache.h ../apic.h \
 ../xmm.h ../vmx.h ../svm.h ../cpuid.h ../stack.h ../access.h \
 ../scalar_arith.h
tbm64.o: tbm64.@CPP_SUFFIX@ ../../bochs.h ../../config.h ../../osdep.h \
 ../../bx_debug/debug.h ../../config.h ../../osdep.h \
 ../../cpu/decoder/decoder.h ../../gui/paramtree.h ../../logio.h \
 ../../instrument/stubs/instrument.h ../cpu.h \
 ../decoder/decoder.h ../i387.h ../fpu/softfloat.h ../fpu/tag_w.h \
 ../fpu/status_w.h ../fpu/control_w.h ../crregs.h ../descriptor.h \
 ../decoder/instr.h ../lazy_flags.h ../tlb.h ../icache.h ../apic.h \
 ../xmm.h ../vmx.h ../svm.h ../cpuid.h ../stack.h ../access.h \
 ../scalar_arith.h
vnni.o: vnni.@CPP_SUFFIX@ ../../bochs.h ../../config.h ../../osdep.h \
 ../../bx_debug/debug.h ../../config.h ../../osdep.h \
 ../../cpu/decoder/decoder.h ../../gui/paramtree.h ../../logio.h \
 ../../instrument/stubs/instrument.h ../cpu.h \
 ../decoder/decoder.h ../i387.h ../fpu/softfloat.h ../fpu/tag_w.h \
 ../fpu/status_w.h ../fpu/control_w.h ../crregs.h ../descriptor.h \
 ../decoder/instr.h ../lazy_flags.h ../tlb.h ../icache.h ../apic.h \
 ../xmm.h ../vmx.h ../svm.h ../cpuid.h ../stack.h ../access.h \
 ../simd_int.h
xop.o: xop.@CPP_SUFFIX@ ../../bochs.h ../../config.h ../../osdep.h \
 ../../bx_debug/debug.h ../../config.h ../../osdep.h \
 ../../cpu/decoder/decoder.h ../../gui/paramtree.h ../../logio.h \
 ../../instrument/stubs/instrument.h ../cpu.h \
 ../decoder/decoder.h ../i387.h ../fpu/softfloat.h ../fpu/tag_w.h \
 ../fpu/status_w.h ../fpu/control_w.h ../crregs.h ../descriptor.h \
 ../decoder/instr.h ../lazy_flags.h ../tlb.h ../icache.h ../apic.h \
 ../xmm.h ../vmx.h ../svm.h ../cpuid.h ../stack.h ../access.h \
 ../simd_int.h ../simd_compare.h
